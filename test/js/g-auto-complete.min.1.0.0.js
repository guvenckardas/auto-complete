!function(a){a.fn.userSearch=function(b){var c={source:"",deferRequest:250,width:"",selectedCssClass:"",mainCssClass:"",isAutoComplete:!1,maxRow:5,content:"",emptyDataContent:"",fullContextSearch:!1,isCaseSensitive:!1,disableRemove:!1,characterReq:2,mainTargetData:""},b=a.extend(c,b),d=function(c){var d=this;d.target=a(c)[0],d.id=d.target.id,d.coverDiv="",a(d.target).attr("autocomplete","off"),a(d.target).wrap('<div class="inputController wrapper"></div>'),d.targetValue="",d.queryValue="",d.stepValue=0,d.rowValue=0,d.pendingRequest=!1,d.bindEvents=function(){a(d.target).bind("keydown",function(b){return 13==b.keyCode?(d.panelRemove(),!1):void a(d.target).parent().siblings(".inputTxt").hide()}),a(d.target).bind("keyup",function(c){var e=d.keyCodeController(c.keyCode),f=d.contentController();if(""==a(d.target).val||e)e&&!f&&(a(d.coverDiv).find(".inputController.mainPanel").removeClass("selected"),d.domSelector(c.keyCode));else{var g=a(d.target)[0].value;a.trim(g).length>b.characterReq-1?(a.trim(g)!=d.targetValue&&(d.queryValue=a.trim(g),0==d.pendingRequest&&(clearTimeout(d.typingTimer),d.typingTimer=setTimeout(d.doneTyping,b.deferRequest))),d.targetValue=a.trim(g)):d.panelRemove()}}),d.controlTaget=b.mainTargetData,a(d.target).bind("blur",d.panelRemove)},a(d.target).ajaxStart(function(){d.pendingRequest=!0}),d.domSelector=function(a){switch(a){case 38:d.stepValue=d.stepValue-1<1?d.rowValue:d.stepValue-1,d.StepAction(d.stepValue);break;case 40:d.stepValue=d.stepValue+1>d.rowValue?1:d.stepValue+1,d.StepAction(d.stepValue);break;case 27:d.panelRemove();break;case 39:d.stepValue=0;break;case 37:d.stepValue=0}},d.StepAction=function(b){a(d.coverDiv).find(".inputController.mainPanel:eq("+(b-1)+")").addClass("selected");var c=a(d.coverDiv).find(".inputController.mainPanel:eq("+(b-1)+")").find('[targetData="'+d.controlTaget+'"]').text();d.dataSender(c)},d.keyCodeController=function(b){var c=!1,d=[37,38,39,40,33,34,35,36,93,20,27,16,17,13];return a(d).each(function(a,d){b==d&&(c=!0)}),c},d.contentController=function(){var b=!1;return a(".inputController.mainPanel").length<=0&&(b=!0),b},d.doneTyping=function(){d.width="100%","object"!=typeof b.source?d.ajaxAction():d.arrayAction()},d.ajaxAction=function(){{var c="",e=!1,f=d.queryValue;a.ajax({url:b.source+"="+f,cache:!1,dataType:"json",success:function(a){c=a,e=!0},complete:function(){0==e&&(c=""),d.pendingRequest=!1,d.endAction(c,f),f!=d.queryValue&&(d.targetValue="",a(d.target).trigger("keyup"))}})}},d.arrayAction=function(){var a=f(b.source,d.queryValue);d.endAction(a)},d.endAction=function(c,f){if(""!=d.targetValue){var g=c;if(g.length<=0){if(b.disableRemove||(a(d.coverDiv).find(".inputController.infoPanel").remove(),a(d.coverDiv).remove()),""!=b.emptyDataContent){d.coverDiv=d.makeCoverDom();var h=document.createElement("div");a(h).addClass("inputController infoPanel"),a(h).append(b.emptyDataContent),a(d.coverDiv).append(h)}d.stepValue=0}else if(d.coverDiv=d.makeCoverDom(),b.disableRemove||a(".inputController.infoPanel").remove(),d.rowValue=g.length>b.maxRow?b.maxRow:g.length,""!=d.queryValue){var i=f||d.queryValue;new e(g,d.rowValue,i)}}else b.disableRemove||a(d.coverDiv).remove()};var e=function(c,e,f){b.disableRemove||a(".inputController.mainPanel").remove();for(var g=0;e>g;g++){var h;h=document.createElement("div"),a(h).addClass("inputController mainPanel"),a(h).addClass(b.mainCssClass),a(h).attr("targetId",c[g].id),a(h).hover(function(){d.stepValue=a(".inputController.mainPanel").index(this),a(".inputController.mainPanel").removeClass("selected"),a(this).addClass("selected")},function(){a(this).removeClass("selected")});var i;i=document.createElement("div"),a(i).addClass("inputController innerPanel"),a(i).append(b.content),a(i).find("*").each(function(d,e){var h=a(e).attr("targetData")||"";if(""!=h){var i=c[g][h];if(a(e).is("img"))a(e).attr("src",i);else if(a(e).attr("targetData")==b.mainTargetData)for(var j=i,k=0;-1!=k;){var l=document.createElement("span");a(l).addClass(b.selectedCssClass);var m="";if(b.isCaseSensitive){var n=j.toLowerCase();f=f.toLowerCase(),m=n.indexOf(f)}else m=j.indexOf(f);var o=j.substring(0,m),p=j.substring(m,m+f.length),q=j.substring(m+f.length);a(e).append(o),a(l).append(p),a(e).append(l),1==b.fullContextSearch?(-1==q.indexOf(f)&&(a(e).append(q),k=-1),j=q):(a(e).append(q),k=-1)}else a(e).append(i)}}),a(h).append(i),a.browser.msie&&parseFloat(a.browser.version)<8&&a(i).css("overflow","hidden"),a(d.coverDiv).append(h)}a(".inputController.innerPanel").bind("click",d.dataSender)};d.panelRemove=function(){""!=d.coverDiv&&(b.disableRemove||a(d.coverDiv).fadeOut(250,function(){a(d.coverDiv).remove()}),d.stepValue=0,d.targetValue=""),""==a(d.target).val()},d.dataSender=function(c){var e=a(".inputController.mainPanel.selected").find('[targetData="'+b.mainTargetData+'"]').text()||c;a(d.target).val(""),a(d.target).val(e),a(d.target).focus()};var f=function(c,e){var f=[],g=d.controlTaget;return a(c).each(function(a,d){var h=d[g],i=h.indexOf(e);if(b.isCaseSensitive){var j=h.toLowerCase();e=e.toLowerCase(),i=j.indexOf(e)}1==b.fullContextSearch?-1!=i&&f.push(c[a]):0==i&&f.push(c[a])}),f.sort(function(a,b){var c=a[g].toLowerCase(),d=b[g].toLowerCase();return d>c?-1:c>d?1:0}),f};d.makeCoverDom=function(){var b;return a(".inputController.wrapper").find('.inputController.coverPanel[targetid="'+d.id+'"]').length>0?b=a(".inputController.wrapper").find('.inputController.coverPanel[targetid="'+d.id+'"]'):(b=document.createElement("div"),a(b).addClass("inputController coverPanel").attr("targetid",d.id),a(b).width(d.width),a(b).css("left",d.left+"px"),a(b).css("top",d.top+"px"),a(b).css("margin-top","2px"),a(b).css("margin-left","2px"),a(".inputController.wrapper").append(b)),b}},e=new d(this);e.bindEvents()}}($);